<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Uncertainties in CMS analyses: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="dpoa-logo" alt="CMS DPOA logo" src="assets/images/dpoa-logo.png"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="CMS DPOA small logo" src="assets/images/dpoa-logo-sm.png">
</div>
    <div class="lesson-title-md">
      Uncertainties in CMS analyses
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Uncertainties in CMS analyses
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Uncertainties in CMS analyses
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-sources.html">2. Uncertainty sources</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-corrections.html">3. Physics object corrections</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="05-challenge.html">4. Uncertainties challenge</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>

                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-introduction"><p>Content from <a href="introduction.html">Introduction</a></p>
<hr>
<p>Last updated on 2024-07-24 |

        <a href="https://github.com/cms-opendata-workshop/workbench-template-md/edit/main/episodes/introduction.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Where do uncertainties come from in CMS analysis?</li>
<li>How important are uncertainties to our results?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Identify the major types of uncertainties typically found in CMS
analyses</li>
<li>Review examples from papers of the impact of uncertainties on the
physics results</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<figure><img src="fig/epistemic_uncertainty_2x.png" style="width:65.0%" alt="Figure from https://xkcd.com/2440. In CMS, the epistemic uncertainty is perhaps “how many unknown bugs did I introduce in my code?”" class="figure mx-auto d-block"><div class="figcaption">Figure from <a href="https://xkcd.com/2440" class="external-link">https://xkcd.com/2440</a>. In CMS, the
epistemic uncertainty is perhaps “how many unknown bugs did I introduce
in my code?”</div>
</figure><p>All CMS algorithms are subject to uncertainty. Such is life!</p>
<section><h2 class="section-heading" id="types-of-uncertainty">Types of uncertainty<a class="anchor" aria-label="anchor" href="#types-of-uncertainty"></a>
<a class="anchor" aria-label="anchor" href="#types-of-uncertainty"></a>
</h2>
<hr class="half-width">
<p>The typical CMS analysis will need to consider the following types of
uncertainty:</p>
<ul>
<li>
<strong>Statistical</strong>: uncertainty due to limited sample
size, either in data or simulation.</li>
<li>
<strong>Systematic</strong>: uncertainty due to any other source!
<ul>
<li>Collisions: the luminosity collected by CMS carries an uncertainty
of just over 1%, and the calculation of the number of simultaneous
collisions per bunch crossing also has uncertainty.</li>
<li>Theory: when using simulation, limited-order generation and the use
of parton density functions contribute some uncertainty to the accuracy
of the simulation.</li>
<li>Detector: reconstruction algorithms used by CMS are never perfectly
modeled by simulation. Correcting physics objects for imperfect detector
response, applying identification algorithms, or even selecting events
using trigger paths require calibration of how the decision affects data
versus simulation. Computing adjustments to the simulation brings along
uncertainties.</li>
<li>Method: all analyses must choose how they will model background,
calculate observables, etc. Many of these choices can contribute
uncertainties.</li>
</ul>
</li>
</ul>
<p>The type of analysis determines which uncertainties are the most
significant. Searches for new physics at high energies are often, but
not always, limited by the available size of the dataset. This can make
constraining systematic uncertainties less important than simply
designing effective selection criteria to remove background events.
Measurements of particle properties are often in the opposite regime –
for many SM particles even partial CMS datasets already provide massive
samples that are useful for precision measurements. The precision, and
therefore the impact, of these measurements can depend heavily on making
analysis choices that contribute the smallest possible
uncertainties.</p>
</section><section><h2 class="section-heading" id="top-quark-cross-section-measurement">Top quark cross section measurement<a class="anchor" aria-label="anchor" href="#top-quark-cross-section-measurement"></a>
<a class="anchor" aria-label="anchor" href="#top-quark-cross-section-measurement"></a>
</h2>
<hr class="half-width">
<p>The top quark cross section was measured in several different final
states using the CMS 2016 dataset. The <a href="https://arxiv.org/pdf/1803.08856" class="external-link">single lepton differential cross
section measurement</a> using this dataset shares a breakdown of all
their uncertainties:</p>
<figure><img src="fig/topxsec_uncerts.PNG" style="width:50.0%" alt="Breakdown of uncertainty contributions to the single lepton top pair different cross section measurement from 2016. Figure from https://arxiv.org/pdf/1803.08856." class="figure mx-auto d-block"><div class="figcaption">Breakdown of uncertainty contributions to the
single lepton top pair different cross section measurement from 2016.
Figure from <a href="https://arxiv.org/pdf/1803.08856" class="external-link uri">https://arxiv.org/pdf/1803.08856</a>.</div>
</figure><p>This figure shows that over a wide range of hadronic top quark
momentum, the statistical uncertainty is completely negligible compared
to systematic uncertainty. The experimental uncertainty groups (Jet
energy, Luminosity, b tagging, and Lepton) tend to be larger than the
other uncertainties, which are related to generation settings for the
top pair simulation.</p>
</section><section><h2 class="section-heading" id="z-search">
<span class="math inline">\(Z'\)</span> search<a class="anchor" aria-label="anchor" href="#z-search"></a>
<a class="anchor" aria-label="anchor" href="#z-search"></a>
</h2>
<hr class="half-width">
<p>The <a href="https://arxiv.org/pdf/1810.05905" class="external-link"><span class="math inline">\(Z'\)</span> search</a> that we are using as an
analysis inspiration uses many of the same individual uncertainties, but
their impact is different. In this analysis the selection criteria are
very stringent and few data events are left in the regions dominated by
<span class="math inline">\(Z'\)</span> signal:</p>
<figure><img src="fig/Zprime1lep1top.PNG" alt="Distributions of m_{t\bar{t}} in the single-lepton signal regions of the 2016 Z' search that had 1 or more top-tagged jets. Figure from https://arxiv.org/pdf/1810.05905." class="figure mx-auto d-block"><div class="figcaption">Distributions of <span class="math inline">\(m_{t\bar{t}}\)</span> in the single-lepton signal
regions of the 2016 <span class="math inline">\(Z'\)</span> search
that had 1 or more top-tagged jets. Figure from <a href="https://arxiv.org/pdf/1810.05905" class="external-link uri">https://arxiv.org/pdf/1810.05905</a>.</div>
</figure><p>In fact, in order to perform the statistical inference for this
analysis, these histograms had to be rebinned such that the statistical
uncertainty stayed below 30% in each bin. The systematic uncertainties
become less important in this search, especially for the higher mass
signal. The authors note that including the systematic uncertainties in
the fit at all have only a 10% effect on the mass limit for <span class="math inline">\(Z'\)</span> masses above about 2 TeV.</p>
<p>In the following episodes we will look more closely at the different
sources of CMS experimental uncertainty and practice evaluating some
uncertainties in our analysis example.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Uncertainties are always divided into statistical and systematic
components</li>
<li>Many precision measurements also divide out luminosity and/or theory
uncertainties</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-02-sources"><p>Content from <a href="02-sources.html">Uncertainty sources</a></p>
<hr>
<p>Last updated on 2024-07-31 |

        <a href="https://github.com/cms-opendata-workshop/workbench-template-md/edit/main/episodes/02-sources.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How are statistical uncertainties modeled in CMS for simulation and
data?</li>
<li>How are systematic uncertainties modeled in CMS?</li>
<li>What are some of the most common uncertainties for CMS physics
objects?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Learn what the error bars mean on CMS plots.</li>
<li>Learn about collision, detector, and data-to-simulation correction
uncertainties.</li>
<li>Identify some published resources with more information.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="statistical-uncertainties">Statistical uncertainties<a class="anchor" aria-label="anchor" href="#statistical-uncertainties"></a>
<a class="anchor" aria-label="anchor" href="#statistical-uncertainties"></a>
</h2>
<hr class="half-width">
<p><strong>Data</strong>: observations by CMS, such as the number of
events in data that pass a certain set of selection criteria, are not in
and of themselves uncertain. However, all CMS plots show error bars on
data in histograms of observables. Let’s view again the image from the
<span class="math inline">\(Z'\)</span> search:</p>
<figure><img src="fig/Zprime1lep1top.PNG" alt="Distributions of m_{t\bar{t}} in the single-lepton signal regions of the 2016 Z' search that had 1 or more top-tagged jets. Figure from https://arxiv.org/pdf/1810.05905." class="figure mx-auto d-block"><div class="figcaption">Distributions of <span class="math inline">\(m_{t\bar{t}}\)</span> in the single-lepton signal
regions of the 2016 <span class="math inline">\(Z'\)</span> search
that had 1 or more top-tagged jets. Figure from <a href="https://arxiv.org/pdf/1810.05905" class="external-link uri">https://arxiv.org/pdf/1810.05905</a>.</div>
</figure><p>In this figure, many bins show an observation of 0 events in data,
particularly in the high mass region. It is clear that this is not a
fundamental statement that no events could ever be observed in those
mass ranges, but merely a truth of this particular dataset collected by
CMS in 2016.</p>
<p>For any observable, such as the number of <span class="math inline">\(t\bar{t}\)</span> events produced in CMS whose
reconstructed mass lies in the 20th bin of the figure above, there is
some “true” mean number of events per 35.9 fb<span class="math inline">\(^{-1}\)</span> of data collected. This true mean
number could perhaps be deduced by CMS repeating its 2016 data
collection over and over again many times and finding in each dataset
how many events lie in the 20th bin of this plot. But since we are
analyzing just one iteration of 2016 data, we must let the observation
in this dataset serve as our best estimate of the true mean. Each
collision exhibiting a given set of properties is an independent random
event, and so their probability follows the <strong>Poisson
distribution</strong>, which has the unique feature that its standard
deviation is the square root of the mean. If our best estimate of the
true mean is the observation we have in hand, then our best estimate of
the variance is the square root of the observation. This estimate is
generally reasonable, until the observation becomes very small, such as
zero events. In this case, the asymmetric shape of the Poisson
distribution is better illustrated by an upward pointing error bar from
0 that describes a one-sided 68% confidence limit.</p>
<figure><img src="fig/drawing.jpg" alt="Julie’s drawing of what error bars on data are trying to portray." class="figure mx-auto d-block"><div class="figcaption">Julie’s drawing of what error bars on data are
trying to portray.</div>
</figure><p><strong>MC</strong>: similar to the argument for data, uncertainty
due to the limited size of a simulated sample is typically the
<strong>square root of the sum of squared weights</strong> in any given
bin. The goal for simulation is to always have sufficient
<em>generated</em> events for any sample that the weights are small.</p>
</section><section><h2 class="section-heading" id="systematic-uncertainties">Systematic uncertainties<a class="anchor" aria-label="anchor" href="#systematic-uncertainties"></a>
<a class="anchor" aria-label="anchor" href="#systematic-uncertainties"></a>
</h2>
<hr class="half-width">
<p>While systematic uncertainties have many different sources and are
computed in many differen ways, the general underlying assumption is
that the variation of an observable due to systematic uncertainty can be
described by the <strong>Gaussian distribution</strong>, or by a
<strong>log-normal distribution</strong> if negative values are not
physical. Experimental uncertainties are usually provided as “up” and
“down” shifts of a parameter, with the assumption that the “up”/“down”
settings model a variation of one standard deviation.</p>
<p>The following sections give a brief introduction to some of the most
common experimental systematic uncertainties for CMS analyses. It is not
an exhaustive list, but a good start.</p>
<div class="section level3">
<h3 id="collision-conditions">Collision conditions<a class="anchor" aria-label="anchor" href="#collision-conditions"></a>
</h3>
<p><strong>Luminosity</strong>: the luminosity uncertainty affects the
number of predicted events for any simulated sample. A simulated sample
is weighted based on (luminosity) <span class="math inline">\(\times\)</span> (cross section) / (number of
generated events), so uncertainty in the luminosity can be directly
converted to uncertainty in the number of signal or background events in
any observable. The luminosity uncertainty for 2016 data is 1.2%.</p>
<p><strong>Pileup</strong>: in simulation, the number of simultaneous
interactions per bunch crossing is modeled by Pythia, based on
measurements of the total cross section for inelastic proton-proton
scattering. In Pythia the typical inelastic cross section for 13 TeV
collisions is 80 mb, while CMS measures 69.2 mb, with an uncertainty of
4.6%. Simulation is reweighted to the CMS inelastic cross section, and
the uncertainty of 4.6% is propagated to analysis observables via a pair
(“up” and “down”) of shifted weights.</p>
</div>
<div class="section level3">
<h3 id="detector-response-corrections">Detector response corrections<a class="anchor" aria-label="anchor" href="#detector-response-corrections"></a>
</h3>
<p><strong>Jet energy scale</strong>: The <a href="https://cms-opendata-workshop.github.io/workshop2024-lesson-physics-objects/instructor/06-jecjer.html" class="external-link">Physics
Object pre-learning lesson</a> describes the various individual
corrections that make up the total “jet energy scale” correction. This
set of corrections adjusts the calculation of jet energy and momentum to
remove effects from pileup (extra energy in a jet) and imperfect
detector response (too little energy in a jet). Each individual
correction is a source of uncertainty – at minimum because the
corrections are derived in limited-size samples.</p>
<p>The figure below shows JES uncertainties from Run 1. The L1 (pileup)
correction uncertainty dominates at low momentum, while the L3 (absolute
scale) correction uncertainty takes over for higher momentum jets. All
corrections are quite precise for jets located near the center of the
CMS barrel region, and the precision drops as pseudorapidity increases
and different subdetectors lose coverage.</p>
<figure><img src="fig/uncertainties.PNG" style="width:70.0%" alt="Uncertainty breakdown for JES in Run 1." class="figure mx-auto d-block"><div class="figcaption">Uncertainty breakdown for JES in Run 1.</div>
</figure><p>JES uncertainties modify the <strong>energy-momentum
4-vector</strong> of a jet, which tends to affect other overables in an
analysis that are computed using jets or MET. These variations must be
propagated all the way through to the final observable. CMS provides JES
uncertainties as a total variation, and also from individual
sources.</p>
<p><strong>Jet energy resolution</strong>: The JER correction changes
the <em>width</em> of the jet momentum distribution, rather than its
<em>position</em>. The correction is provided as a set of “scale
factors”, or multipliers, that affect the amount of Gaussian smearing
applied to jet momentum in simulation. The scale factors in various
pseudorapidity bins each have an uncertainty that comes from treatment
of extra radiation in data, differences in MC generators, and other
effects. The figure below shows the scale factors and their
uncertainties from Run 1. Note how the larger data sample available for
8 TeV collisions corresponds to smaller uncertainties on the scale
factors compared to 7 TeV! JER uncertainties also affect the
<strong>energy-momentum 4-vector</strong> of a jet, independent from the
JES variations!</p>
<figure><img src="fig/jerfactors.JPG" style="width:50.0%" alt="JER scale factors with uncertainties from Run 1." class="figure mx-auto d-block"><div class="figcaption">JER scale factors with uncertainties from Run
1.</div>
</figure><p><strong>Lepton energy scale and resolution</strong>: in precision
measurements, leptons can also benefit from corrections for energy scale
and resolution. While all analyses using jets must apply the JES
corrections, not all analyses require these corrections for leptons. As
the name suggests, <em>CMS</em> has a very strong muon detector and
robust reconstruction algorithms, so extra muon energy corrections are
not common. Similar for electrons – scale and smear studies are
performed by the group responsible for electron reconstruction and
identification, but they are not required for use in all analyses.</p>
<p>Lepton scale and resolution corrections affect the
<strong>energy-momentum 4-vector</strong> of a lepton, so their
uncertainties would be propagated to the final observable by repeating
any calculations involving leptons using the energy/momentum variations.
You can read more about the lepton energy scale measurements in the
following papers:</p>
<ul>
<li>Muon performance: <a href="https://arxiv.org/abs/1804.04528" class="external-link uri">https://arxiv.org/abs/1804.04528</a>
</li>
<li>Electron and photon performance: <a href="https://arxiv.org/abs/2012.06888" class="external-link uri">https://arxiv.org/abs/2012.06888</a>
</li>
<li>Tau performance: <a href="https://arxiv.org/abs/1809.02816" class="external-link uri">https://arxiv.org/abs/1809.02816</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="datamc-scale-factors">Data/MC scale factors<a class="anchor" aria-label="anchor" href="#datamc-scale-factors"></a>
</h3>
<div id="what-is-a-scale-factor" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-is-a-scale-factor" class="callout-inner">
<h3 class="callout-title">What is a scale factor?<a class="anchor" aria-label="anchor" href="#what-is-a-scale-factor"></a>
</h3>
<div class="callout-content">
<p>A “scale factor” is a number that should be multiplied onto some
quantity so that it matches a different quantity. In CMS, scale factors
usually adjust the <strong>event weight</strong> of a simulated event,
so that histograms filled by simulated events match the histogram of the
same observable in data.</p>
</div>
</div>
</div>
<p><strong>Trigger</strong>: analysts often apply the same trigger path
in data and simulation. But the efficiency of the trigger path depends
on the kinematics of the physics objects used, and it might vary between
data and simulation. Most analysts need to compute the efficiencies of
the triggers they use, and then compute scale factors comparing data and
simulation efficiencies. The uncertainty in each efficiency can be
propagated to the scale factor, and then to the final analysis
observable.</p>
<p><strong>Leptons</strong>: selecting leptons usually involves choosing
an identification criterion and an isolation criterion. The efficiency
of these algorithms to identify “true” leptons can vary between
simulation and data! For muons and electrons, scale factors are
typically calculated using <a href="https://cms-opendata-workshop.github.io/workshop-lesson-tagandprobe/aio/index.html" class="external-link">Z
boson tag-and-probe</a>, which was featured in an earlier workshop.</p>
<p>Tag and probe can be done with any 2-lepton resonance, such as <span class="math inline">\(J/\psi\)</span> or <span class="math inline">\(\Upsilon\)</span> mesons, though <span class="math inline">\(Z\)</span> bosons are preferred for
higher-momentum leptons. Events are selected with two leptons of the
same flavor but opposite charge, and a stringent requirement is placed
on the invariant mass of the lepton pair, so that we can be reasonably
sure the event was “really” the desired resonance particle. For these
events, we are then reasonably sure that both leptons are “true” signal
leptons, not the result of detector noise. In the tag-and-probe process,
the “tag” lepton is required to pass selection criteria that reject
large fractions of “background” or “noise” leptons. The <em>other</em>
lepton is the probe, and the rate at which it passes or fails any number
of selection criteria can be tested. The figure below shows how
distributions of the resonance mass are fitted to extract the number of
particles whose probe lepton passed the criteria.</p>
<figure><img src="fig/tagprobe.png" style="width:100.0%" alt="Demonstration of fits in a muon tag-and-probe procedure" class="figure mx-auto d-block"><div class="figcaption">Demonstration of fits in a muon tag-and-probe
procedure</div>
</figure><p>Uncertainties in scale factors calculated using the tag-and-probe
procedure can come from a variety of sources:</p>
<ul>
<li>Change the binning of the histograms</li>
<li>Change the resonance particle mass range accepted</li>
<li>Change the functional form used to fit the signal</li>
<li>Change the functional form used to fit the background</li>
<li>Statistical uncertainty</li>
<li>Uncertainty in the fit parameters</li>
</ul>
<p>Thankfully, these variations usually result in only small changes to
the efficiency and therefore the scale factor! They are usually combined
in quadrature to one variation. You can read more in the lepton
performance papers:</p>
<ul>
<li>Muon performance: <a href="https://arxiv.org/abs/1804.04528" class="external-link uri">https://arxiv.org/abs/1804.04528</a>
</li>
<li>Electron and photon performance: <a href="https://arxiv.org/abs/2012.06888" class="external-link uri">https://arxiv.org/abs/2012.06888</a>
</li>
<li>Tau performance: <a href="https://arxiv.org/abs/1809.02816" class="external-link uri">https://arxiv.org/abs/1809.02816</a>
</li>
</ul>
<p><strong>Jet identification</strong>: The jet identification algorithm
designed to reject noise jets is usually 98-99% efficienct for true
jets, and this efficiency tends to match between data and simulation, so
most analyses do not include a scale factor or uncertainty for this
algorithm. Yay!</p>
<p>However, jets more than make up for the efficiency of their
noise-rejection ID with the complexity of the scale factors and
uncertainties for parent-particle identification algoriths like b
tagging, W tagging, or top tagging. The goal of scale factors for these
algorithms is the same as all others: bring simulation to match data.
But while “detector noise” versus “actual jet” is a fairly concrete
question, “b quark jet” versus “c quark jet” is much more subtle. In
simulation, where the “true” parent particles behind any jet can be
determined, it is fairly straightforward to measure the efficiency with
which true t, W, Higgs, Z, b, c, or light quark jets will pass a certain
tagging criterion. But to measure the same in data, an event selection
must be defined that can bring “reasonable certainty”, as we mentioned
for tag-and-probe, that the jets considered are actually b quark jets, W
boson jets, top quark jets, etc. As in the case of tag-and-probe,
calculating these efficiencies will usually involve fits that bring in
many sources of uncertainty. The uncertainties can vary based on jet
kinematics and the jet’s parent particle.</p>
<p>Scale factors and their uncertainties for many jet identification
algorithms in the 2016 dataset are documented in the following
sources:</p>
<ul>
<li>Identification of b and c quarks: <a href="https://cds.cern.ch/record/2854609/" class="external-link uri">https://cds.cern.ch/record/2854609/</a>
</li>
<li>Double-b identification for Higgs bosons: <a href="http://cds.cern.ch/record/2866276" class="external-link uri">http://cds.cern.ch/record/2866276</a>
</li>
<li>Heavy particle identification (H, W, t): <a href="https://arxiv.org/abs/2004.08262" class="external-link uri">https://arxiv.org/abs/2004.08262</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="analysis-method-choices">Analysis method choices<a class="anchor" aria-label="anchor" href="#analysis-method-choices"></a>
</h3>
<p>Uncertainties for corrections to physics objects are often provided
by CMS, at least for any required corrections, and for the most popular
identification algorithms. But uncertainties also arise from analysis
strategy choices. There is no way to write an exhaustive list of these
uncertainties! But as you build an analysis, consider:</p>
<ul>
<li>Have I calculated any custom corrections for physics objects?</li>
<li>Have I performed any fits to model background and/or signal?</li>
<li>Have I computed any “transfer factors” to model background in a
certain region using information from other regions?</li>
<li>Have I designed a validation procedure for my background modeling
strategy?</li>
</ul>
<p>All of these methods, and surely others, will need to be evaluated
for uncertainties that should be propagated to your final observable.
Uncertainties in fit parameters, statistical uncertainties in various
regions, any deviation from expectations in a validation procedure – all
are examples of analysis method uncertainties you might find in CMS
papers and consider in your work.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Data in CMS plots carry error bars that serve as a “best estimate”
of the variance of the Poisson distribution that governs the expected
observations for each observable.</li>
<li>Systematic uncertainties are assumed to follow Gaussian or
log-normal probability distributions.</li>
<li>Collision-based uncertainties come from the luminosity and pileup
calculations.</li>
<li>Detector-based uncertainties come from corrections to the energy
response for different physics objects.</li>
<li>Scale factor-based uncertainties come from the calculation methods
used to measure efficiencies for various reconstruction, identification,
isolation, and trigger algorithms.</li>
<li>Analysis methods also bring in uncertainties that need to be
determined by the analysis team.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-03-corrections"><p>Content from <a href="03-corrections.html">Physics object corrections</a></p>
<hr>
<p>Last updated on 2024-07-26 |

        <a href="https://github.com/cms-opendata-workshop/workbench-template-md/edit/main/episodes/03-corrections.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What corrections are provided by CMS for pileup?</li>
<li>What corrections are provided by CMS for leptons?</li>
<li>What corrections are provided by CMS for jets and MET?</li>
<li>How can I access the corrections?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explore the corrections webpage for 2016 data.</li>
<li>Install the framework used by CMS to apply the common experimental
corrections.</li>
<li>Learn how to access a correction and its numerical value.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="corrections-webpage" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="corrections-webpage" class="callout-inner">
<h3 class="callout-title">2016 corrections webpage<a class="anchor" aria-label="anchor" href="#corrections-webpage"></a>
</h3>
<div class="callout-content">
<p>Open this website in your browser! <a href="https://opendata.cern.ch/eos/opendata/cms/corrections/jsonpog-integration-summary/index.html" class="external-link uri">https://opendata.cern.ch/eos/opendata/cms/corrections/jsonpog-integration-summary/index.html</a></p>
</div>
</div>
</div>
<p>CMS provides all of the corrections that are “required” for sensible
analysis results (in most cases), and also provides scale factors for
some of the most common identification and isolation algorithms. Prior
to 2016, these corrections were shared with analysts as histograms, via
PDF files, via TWiki pages, or other forms, and each group calculating a
correction could choose the format. For Run 2 data, a common JSON format
has been introduced that simplifies and unifies the process of accessing
correction values and their uncertainties.</p>
<section><h2 class="section-heading" id="exploring-the-correction-website">Exploring the correction website<a class="anchor" aria-label="anchor" href="#exploring-the-correction-website"></a>
<a class="anchor" aria-label="anchor" href="#exploring-the-correction-website"></a>
</h2>
<hr class="half-width">
<p>When you click on the website link above, you should see the
following page:</p>
<figure><img src="fig/JSONsummary.PNG" alt="Contents of the correction summary webpage" class="figure mx-auto d-block"><div class="figcaption">Contents of the correction summary webpage</div>
</figure><p>The columns describe:</p>
<ul>
<li>The acronym of the CMS group that produced the correction:
<ul>
<li>BTV = B-tagging &amp; vertexing</li>
<li>EGM = E &amp; Gamma (electrons &amp; photons)</li>
<li>JME = Jets &amp; MET</li>
<li>LUM = Luminosity, including pileup</li>
<li>MUO = Muons</li>
<li>TAU = Tau leptons</li>
</ul>
</li>
<li>Information about the CMS dataset:
<ul>
<li>Era: currently, the page shows “2016postVFP”, which applies to the
Run2016G and Run2016H data released in 2024. As we release more Run 2
data, additional eras will appear on this website.</li>
<li>Campaign: “UL” = “Ultra-Legacy”. The open data released for 2016 is
not the earliest processing of 2016 data, but the final processing that
is uniform with the rest of the Run 2 data that will be released in
coming years.</li>
<li>LHC Run: Run 2! If you revisit this site in 2028 or 2029 you might
begin to see some “Run 3” corrections.</li>
</ul>
</li>
<li>The files available with corrections. These are clickable links that
take you to a summary page for the corrections contained within that
file.</li>
</ul></section><section><h2 class="section-heading" id="correction-file-structure">Correction file structure<a class="anchor" aria-label="anchor" href="#correction-file-structure"></a>
<a class="anchor" aria-label="anchor" href="#correction-file-structure"></a>
</h2>
<hr class="half-width">
<p>Click on a correction file to explore it!</p>
<p>One of the simplest examples is the <a href="https://opendata.cern.ch/eos/opendata/cms/corrections/jsonpog-integration-summary/summaries/EGM_2016postVFP_UL_electron.html" class="external-link">electron
correction file</a>. When clicking on that link, you see a description
of the correction contained in the file:</p>
<figure><img src="fig/electronCorr.PNG" alt="Description of the 2016 electron correction" class="figure mx-auto d-block"><div class="figcaption">Description of the 2016 electron
correction</div>
</figure><div id="identify-correction-elements" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="identify-correction-elements" class="callout-inner">
<h3 class="callout-title">Identify correction elements<a class="anchor" aria-label="anchor" href="#identify-correction-elements"></a>
</h3>
<div class="callout-content">
<p>Important information for accessing the correction in an analysis is
included on this page. Look and find:</p>
<ul>
<li>The <strong>name</strong> of the correction</li>
<li>The required <strong>input values</strong>: what information must
you provide to get a correction value out of this JSON file? What types
are the required inputs? What ranges can the inputs take?</li>
<li>The expected <strong>output value</strong>: what piece of
information will be returned by the correction? What type will it
have?</li>
</ul>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>For the electron correction, the <strong>name</strong> is
“UL-Electron-ID-SF”. The “(v2)” that appears next to the name is
indicating a version of the correction JSON software, and is not part of
the name.</p>
<p>There are five <strong>input values</strong> required to access the
electron correction:</p>
<ul>
<li>“year”: this is unfortunately a bit redundant, but you must provide
the string “2016postVFP” when accessing this correction.</li>
<li>“ValType”: this input allows you to specify whether you would like
to access the scale factor (“sf”) or one of its systematic uncertainty
variations (“sfdown”, “sfup”).</li>
<li>“WorkingPoint”: this inputs allows you to specify which electron
identification algorithm you are using.
<ul>
<li>“RecoAbove20”, “RecoBelow20”: these names will access scale factors
for the electron reconstruction algorithm for electrons with energy
either above or below 20 GeV.</li>
<li>“Veto”, “Loose”, “Medium”, “Tight”: these are the working points of
the <code>Electron\_cutBased</code> identification algorithm.</li>
<li>“wp80iso”, “wp80noiso”, “wp90iso”, “wp90noiso”: these are the
working points of the MVA identification algorithm. The number indicates
the efficiency for identifying true electrons (80% or 90%), and
“iso”/“noiso” indicates whether or not isolation was included in the
training variables for the MVA. In NanoAOD the branches for these
identification algorithms look like
<code>Electron_mvaFall17V2*_WP*</code>.</li>
</ul>
</li>
<li>The <span class="math inline">\(\eta\)</span> and <span class="math inline">\(p_T\)</span> values for the electron. Both are to
be provided as <code>float</code> values, and the electron’s <span class="math inline">\(p_T\)</span> value must be larger than 10 GeV for
the correction to be found.</li>
</ul>
<p>The output will be a float that corresponds to a <strong>scale
factor</strong>. The scale factor or one of its systematic variations
should be multiplied onto the event weight. We will show this in an
upcoming exercise.</p>
</div>
</div>
</div>
</div>
<p>Explore other correction files for jets, leptons, etc. The table
below gives a basic map of what you expect to find in the different
files:</p>
<table class="table">
<caption>This table gives a high-level summary of which types of
corrections live in which JSON files</caption>
<thead><tr class="header">
<th>Correction type</th>
<th>Physics object</th>
<th>File</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Collision</td>
<td>Pileup</td>
<td>puWeights</td>
</tr>
<tr class="even">
<td>Detector response</td>
<td>Jets</td>
<td>jet_jerc, fatjet_jerc, jetvetomaps</td>
</tr>
<tr class="odd">
<td>Detector response</td>
<td>MET</td>
<td>met</td>
</tr>
<tr class="even">
<td>Detector response</td>
<td>Taus</td>
<td>tau</td>
</tr>
<tr class="odd">
<td>Scale factors</td>
<td>Muons</td>
<td>muon_JPsi, muon_Z, muon_HighPt</td>
</tr>
<tr class="even">
<td>Scale factors</td>
<td>Electrons</td>
<td>electron</td>
</tr>
<tr class="odd">
<td>Scale factors</td>
<td>Photons</td>
<td>photon</td>
</tr>
<tr class="even">
<td>Scale factors</td>
<td>Taus</td>
<td>tau</td>
</tr>
<tr class="odd">
<td>Scale factors</td>
<td>Jets</td>
<td>btagging, ctagging, subjet_btagging, jmar</td>
</tr>
</tbody>
</table></section><section><h2 class="section-heading" id="software-for-accessing-corrections">Software for accessing corrections<a class="anchor" aria-label="anchor" href="#software-for-accessing-corrections"></a>
<a class="anchor" aria-label="anchor" href="#software-for-accessing-corrections"></a>
</h2>
<hr class="half-width">
<div id="install-correctionlib" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="install-correctionlib" class="callout-inner">
<h3 class="callout-title">Install correctionlib<a class="anchor" aria-label="anchor" href="#install-correctionlib"></a>
</h3>
<div class="callout-content">
<p>Open your python docker container and install
<code>correctionlib</code>:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">docker</span> start <span class="at">-i</span> my_python</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">pip</span> install correctionlib</span></code></pre>
</div>
<p>After <code>pip</code> installs any dependencies, you should see a
message that version 2.6.1 has been installed:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Successfully installed correctionlib-2.6.1</code></pre>
</div>
<p>Download all the corrections files and unpack them:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">wget</span> https://opendata.cern.ch/eos/opendata/cms/corrections/jsonpog-integration-2016post.tar</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-xf</span> jsonpog-integration-2016post.tar</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">rm</span> jsonpog-integration-2016post.tar</span></code></pre>
</div>
<p>You should now see a folder called “POG” in your container with
subdirectories for each CMS group:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">ls</span> POG/</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>BTV  EGM  JME  LUM  MUO  TAU</code></pre>
</div>
</div>
</div>
</div>
<p>In the final episode, we will see how to use the
<code>correctionlib</code> package to access the corrections in the
files</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The available 2016 corrections and a summary website can be accessed
from the Open Data Portal (a “record” page for the corrections is
forthcoming).</li>
<li>Mandatory corrections such as pileup and jet energy corrections are
provided.</li>
<li>Scale factors for many reconstruction and identification algorithms
are also provided.</li>
<li>The summary webpage is the best reference to understand the names,
inputs, and outputs of the corrections.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-05-challenge"><p>Content from <a href="05-challenge.html">Uncertainties challenge</a></p>
<hr>
<p>Last updated on 2024-07-31 |

        <a href="https://github.com/cms-opendata-workshop/workbench-template-md/edit/main/episodes/05-challenge.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I use correctionLib to evaluate a scale factor and its
uncertainty?</li>
<li>How do I propagate an uncertainty through my analysis?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use correctionLib in the python environment to access scale
factors.</li>
<li>Compute shifted variables within the <span class="math inline">\(Z'\)</span> analysis</li>
<li>Store histograms in a ROOT file for the next lesson</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>The goal of this exercise is to use the <code>correctionlib</code>
tool to access some scale factors and apply them to our <span class="math inline">\(Z`\)</span> search. We will also see one way to
store histograms in a <code>ROOT</code> file for use in the next lesson
on statistical inference.</p>
<div id="prereq1" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Prerequisite<a class="anchor" aria-label="anchor" href="#prereq1"></a>
</h3>
<div class="callout-content">
<p>For the activities in this session you will need:</p>
<ul>
<li>Your python docker container and ROOT docker container</li>
<li>
<code>correctionlib</code> installed in your python container</li>
<li>The <code>POG/</code> folder of correction files</li>
<li>At least one <code>.csv</code> file produced in the lessons
yesterday.</li>
</ul>
</div>
</div>
</div>
<div id="just-in-case" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="just-in-case" class="callout-inner">
<h3 class="callout-title">Just in case…<a class="anchor" aria-label="anchor" href="#just-in-case"></a>
</h3>
<div class="callout-content">
<p>We think at this point everyone will have .csv files with our stored
data. In case you don’t, download some example files into the shared
folder of your Python container</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">wget</span> https://github.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/raw/main/instructors/SUMMED_Wjets.csv</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">wget</span> https://github.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/raw/main/instructors/SUMMED_collision.csv</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">wget</span> https://github.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/raw/main/instructors/SUMMED_signal_M2000.csv</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/main/instructors/SUMMED_tthadronic.csv</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">wget</span> https://github.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/raw/main/instructors/SUMMED_ttleptonic.csv</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">wget</span> https://github.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/blob/main/instructors/SUMMED_ttsemilep.csv</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">wget</span> https://github.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/raw/main/instructors/output_signal_22BAB5D2-9E3F-E440-AB30-AE6DBFDF6C83.csv</span></code></pre>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="demo-muon-scale-factors">Demo: muon scale factors<a class="anchor" aria-label="anchor" href="#demo-muon-scale-factors"></a>
<a class="anchor" aria-label="anchor" href="#demo-muon-scale-factors"></a>
</h2>
<hr class="half-width">
<p>To show how to open and use a correction file, we will walk through
the following notebook together as a demonstration. Download a notebook
and launch jupyter-lab:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">docker</span> start <span class="at">-i</span> my_python</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">code/$</span> wget https://raw.githubusercontent.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/main/learners/CorrectionLib_demo.ipynb</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="ex">code/$</span> jupyter-lab <span class="at">--ip</span><span class="op">=</span>0.0.0.0 <span class="at">--no-browser</span></span></code></pre>
</div>
<p>Double-click on this notebook in the file menu of jupyter-lab. This
notebook shows how to access the scale factor for our muon
identification algorithm.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Correctionlib demo notebook contents
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="im">import</span> correctionlib</span></code></pre>
</div>
<div class="section level3">
<h3 id="open-a--csv-file-into-an-array">Open a .csv file into an array<a class="anchor" aria-label="anchor" href="#open-a--csv-file-into-an-array"></a>
</h3>
<p><strong>Replace the .csv file name below with one that you have in
your container.</strong></p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>signal <span class="op">=</span> np.genfromtxt(<span class="st">'output_signal_22BAB5D2-9E3F-E440-AB30-AE6DBFDF6C83.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>, names<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="open-a-correction-file-and-access-the-muon-tight-id-correction">Open a correction file and access the muon tight ID correction<a class="anchor" aria-label="anchor" href="#open-a-correction-file-and-access-the-muon-tight-id-correction"></a>
</h3>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">"POG/MUO/2016postVFP_UL/muon_Z.json.gz"</span>,<span class="st">'rt'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">file</span>.read().strip()</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    evaluator <span class="op">=</span> correctionlib._core.CorrectionSet.from_string(data)</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>tightIDSF <span class="op">=</span> evaluator[<span class="st">"NUM_TightID_DEN_TrackerMuons"</span>]</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="get-the-input-lists-we-need-and-evaluate-the-correction">Get the input lists we need and evaluate the correction<a class="anchor" aria-label="anchor" href="#get-the-input-lists-we-need-and-evaluate-the-correction"></a>
</h3>
<p>The <code>evaluate</code> method in <code>correctionlib</code> is
used to access specific correction values. In python, this function uses
the syntax: <code>evaluate(input 1, input 2, input 3, ...)</code>. The
inputs should be provided in the order they appear on the summary
webpage of the correction. The muon correction we are showing here
cannot accept numpy arrays inside the <code>evaluate</code> call, so we
will iterate over the input arrays.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>muon_pt <span class="op">=</span> signal[<span class="st">'mu_pt'</span>]</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>muon_abseta <span class="op">=</span> signal[<span class="st">'mu_abseta'</span>]</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>genWeight <span class="op">=</span> signal[<span class="st">'weight'</span>]</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>leadmuon_sf <span class="op">=</span> [tightIDSF.evaluate(eta,pt,<span class="st">"nominal"</span>) <span class="cf">for</span> pt,eta <span class="kw">in</span> <span class="bu">zip</span>(muon_pt,muon_abseta)]</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>leadmuon_sfup <span class="op">=</span> [tightIDSF.evaluate(eta,pt,<span class="st">"systup"</span>) <span class="cf">for</span> pt,eta <span class="kw">in</span> <span class="bu">zip</span>(muon_pt,muon_abseta)]</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>leadmuon_sfdn <span class="op">=</span> [tightIDSF.evaluate(eta,pt,<span class="st">"systdown"</span>) <span class="cf">for</span> pt,eta <span class="kw">in</span> <span class="bu">zip</span>(muon_pt,muon_abseta)]</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="bu">print</span>(leadmuon_sf[<span class="dv">0</span>:<span class="dv">10</span>])</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="bu">print</span>(leadmuon_sfup[<span class="dv">0</span>:<span class="dv">10</span>])</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="bu">print</span>(leadmuon_sfdn[<span class="dv">0</span>:<span class="dv">10</span>])</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="plot-the-effect-of-this-uncertainty-on-the-z-mass">Plot the effect of this uncertainty on the Z’ mass<a class="anchor" aria-label="anchor" href="#plot-the-effect-of-this-uncertainty-on-the-z-mass"></a>
</h3>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>plt.hist(muon_pt,bins<span class="op">=</span><span class="dv">30</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">600</span>),weights<span class="op">=</span>genWeight<span class="op">*</span>leadmuon_sf,histtype<span class="op">=</span><span class="st">"step"</span>,color<span class="op">=</span><span class="st">"k"</span>,label<span class="op">=</span><span class="st">"nominal"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>plt.hist(muon_pt,bins<span class="op">=</span><span class="dv">30</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">600</span>),weights<span class="op">=</span>genWeight<span class="op">*</span>leadmuon_sfup,histtype<span class="op">=</span><span class="st">"step"</span>,color<span class="op">=</span><span class="st">"r"</span>,label<span class="op">=</span><span class="st">"up"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>plt.hist(muon_pt,bins<span class="op">=</span><span class="dv">30</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">600</span>),weights<span class="op">=</span>genWeight<span class="op">*</span>leadmuon_sfdn,histtype<span class="op">=</span><span class="st">"step"</span>,color<span class="op">=</span><span class="st">"b"</span>,label<span class="op">=</span><span class="st">"down"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>plt.legend()</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>plt.xlabel(<span class="st">'muon pT (GeV)'</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>plt.ylabel(<span class="st">'events / 20 GeV'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/muonUncerts.PNG" style="width:50.0%" alt="Plot of the muon SF uncertainties" class="figure mx-auto d-block"><div class="figcaption">Plot of the muon SF uncertainties</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="exercise-implement-pileup-reweighting">Exercise: implement pileup reweighting<a class="anchor" aria-label="anchor" href="#exercise-implement-pileup-reweighting"></a>
<a class="anchor" aria-label="anchor" href="#exercise-implement-pileup-reweighting"></a>
</h2>
<hr class="half-width">
<div id="implement-pileup-reweighting" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="implement-pileup-reweighting" class="callout-inner">
<h3 class="callout-title">Implement pileup reweighting<a class="anchor" aria-label="anchor" href="#implement-pileup-reweighting"></a>
</h3>
<div class="callout-content">
<p>Follow the example of the previous notebook to implement pileup
reweighting on your own!</p>
<p>Suggestions:</p>
<ul>
<li>Revisit the corrections website to learn the name of and inputs to
the pileup correction</li>
<li>Access any required inputs from your .csv file</li>
<li>Adjust the muon example to read the correct file and access the
right correction</li>
</ul>
<p>You can work in the same notebook that you downloaded for the muon
correction.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Open the pileup correction file and access the correction
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">"POG/LUM/2016postVFP_UL/puWeights.json.gz"</span>,<span class="st">'rt'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">file</span>.read().strip()</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>    evaluator <span class="op">=</span> correctionlib._core.CorrectionSet.from_string(data)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    </span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>pileupcorr <span class="op">=</span> evaluator[<span class="st">"Collisions16_UltraLegacy_goldenJSON"</span>]</span></code></pre>
</div>
<div class="section level3">
<h3 id="get-the-necessary-inputs-from-the-data-array-and-call-evaluate">Get the necessary inputs from the data array and call evaluate<a class="anchor" aria-label="anchor" href="#get-the-necessary-inputs-from-the-data-array-and-call-evaluate"></a>
</h3>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>pu <span class="op">=</span> signal[<span class="st">'pileup'</span>]</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>pu_sf <span class="op">=</span> [pileupcorr.evaluate(nInts,<span class="st">"nominal"</span>) <span class="cf">for</span> nInts <span class="kw">in</span> pu]</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>pu_sfup <span class="op">=</span> [pileupcorr.evaluate(nInts,<span class="st">"up"</span>) <span class="cf">for</span> nInts <span class="kw">in</span> pu]</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>pu_sfdn <span class="op">=</span> [pileupcorr.evaluate(nInts,<span class="st">"down"</span>) <span class="cf">for</span> nInts <span class="kw">in</span> pu]</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="plot-the-z-mass-with-the-pileup-weight-applied-and-its-uncertainty-shifts">Plot the Z’ mass with the pileup weight applied, and its uncertainty
shifts<a class="anchor" aria-label="anchor" href="#plot-the-z-mass-with-the-pileup-weight-applied-and-its-uncertainty-shifts"></a>
</h3>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>plt.hist(signal[<span class="st">'mtt'</span>],bins<span class="op">=</span><span class="dv">50</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">3000</span>),weights<span class="op">=</span>genWeight<span class="op">*</span>pu_sf,histtype<span class="op">=</span><span class="st">"step"</span>,color<span class="op">=</span><span class="st">"k"</span>,label<span class="op">=</span><span class="st">"nominal"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>plt.hist(signal[<span class="st">'mtt'</span>],bins<span class="op">=</span><span class="dv">50</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">3000</span>),weights<span class="op">=</span>genWeight<span class="op">*</span>pu_sfup,histtype<span class="op">=</span><span class="st">"step"</span>,color<span class="op">=</span><span class="st">"r"</span>,label<span class="op">=</span><span class="st">"up"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>plt.hist(signal[<span class="st">'mtt'</span>],bins<span class="op">=</span><span class="dv">50</span>,<span class="bu">range</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">3000</span>),weights<span class="op">=</span>genWeight<span class="op">*</span>pu_sfdn,histtype<span class="op">=</span><span class="st">"step"</span>,color<span class="op">=</span><span class="st">"b"</span>,label<span class="op">=</span><span class="st">"down"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>plt.legend()</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>plt.xlabel(<span class="st">'m(tt) (GeV)'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>plt.ylabel(<span class="st">'events / 60 GeV'</span>)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/puUncerts.PNG" style="width:50.0%" alt="Plot of the pileup reweighting uncertainties" class="figure mx-auto d-block"><div class="figcaption">Plot of the pileup reweighting
uncertainties</div>
</figure><p>This uncertainty is larger than the muon scale factor uncertainty! It
is also interesting to plot the uncertainty in the pileup distribution
itself:</p>
<figure><img src="fig/puDistrib.PNG" style="width:50.0%" alt="Plot of the pileup distribution" class="figure mx-auto d-block"><div class="figcaption">Plot of the pileup distribution</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="demo-convert-to-root-histograms">Demo: convert to ROOT histograms<a class="anchor" aria-label="anchor" href="#demo-convert-to-root-histograms"></a>
<a class="anchor" aria-label="anchor" href="#demo-convert-to-root-histograms"></a>
</h2>
<hr class="half-width">
<p>To prepare for the final step of our analysis example, we need to
store our histograms in the <code>ROOT</code> file format. In
yesterday’s exercise to make a plot with data, background, and signal,
you saw some ways to handle information from multiple samples. This
example will be similar: we will read in the full <code>.csv</code>
output from the entire signal, background, and collision datasets and
produce a histogram. But this time we will also evaluate uncertainties
and convert the data to ROOT. Because our <code>correctionlib</code>
infrastructure lives in the python container, we will make histograms in
the python container, and then write them to a ROOT file in the ROOT
container.</p>
<p>Download the following notebook and follow along. In jupyter-lab, you
can open a terminal to perform the download.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/main/learners/HistsWithWeights.ipynb</span></code></pre>
</div>
<p>We will walk through this notebook together. It does not introduce
any significant new skills or knowledge, but repeats the type of
processing we have done before on multiple samples at once.</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Histogram prep notebook contents
  </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="im">import</span> correctionlib</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="im">import</span> os</span></code></pre>
</div>
<div class="section level3">
<h3 id="read-csv-files">Read CSV files<a class="anchor" aria-label="anchor" href="#read-csv-files"></a>
</h3>
<p>First, we will open the .csv files we saved during the event
selection process and store all the data in a dictionary. We will also
create a dictionary to hold the number of events for each sample that we
found in yesterday’s background modeling lesson. The keys of these
dictionaries will be the types of data samples we are using in this
search.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>datadict <span class="op">=</span> {}</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>datadict[<span class="st">'signal'</span>] <span class="op">=</span> np.genfromtxt(<span class="st">'SUMMED_signal_M2000.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>, names<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>datadict[<span class="st">'tt_semilep'</span>] <span class="op">=</span> np.genfromtxt(<span class="st">'SUMMED_ttsemilep.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>, names<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>datadict[<span class="st">'tt_had'</span>] <span class="op">=</span> np.genfromtxt(<span class="st">'SUMMED_tthadronic.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>, names<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>datadict[<span class="st">'tt_lep'</span>] <span class="op">=</span> np.genfromtxt(<span class="st">'SUMMED_ttleptonic.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>, names<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>datadict[<span class="st">'wjets'</span>] <span class="op">=</span> np.genfromtxt(<span class="st">'SUMMED_Wjets.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>, names<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>datadict[<span class="st">'data'</span>] <span class="op">=</span> np.genfromtxt(<span class="st">'SUMMED_collision.csv'</span>, delimiter<span class="op">=</span><span class="st">','</span>, names<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>N_gen <span class="op">=</span> {<span class="st">'signal'</span>:<span class="fl">527218.0</span>, </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>         <span class="st">'tt_semilep'</span>:<span class="fl">143553998.0</span>, </span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>         <span class="st">'tt_had'</span>: <span class="fl">100522516.0</span>, </span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>         <span class="st">'tt_lep'</span>:<span class="fl">41777512.0</span>, </span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>         <span class="st">'wjets'</span>:<span class="fl">20521145.0</span>,</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>         <span class="st">'data'</span>:<span class="fl">0.0</span>}</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="open-correctionlib-files">Open correctionlib files<a class="anchor" aria-label="anchor" href="#open-correctionlib-files"></a>
</h3>
<p>Now we will load the two correctionlib JSON files that we used in the
earlier examples, and access the specific corrections that we need.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">"POG/LUM/2016postVFP_UL/puWeights.json.gz"</span>,<span class="st">'rt'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">file</span>.read().strip()</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>    evaluator <span class="op">=</span> correctionlib._core.CorrectionSet.from_string(data)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="cf">with</span> gzip.<span class="bu">open</span>(<span class="st">"POG/MUO/2016postVFP_UL/muon_Z.json.gz"</span>,<span class="st">'rt'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    data <span class="op">=</span> <span class="bu">file</span>.read().strip()</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>    evaluatorMU <span class="op">=</span> correctionlib._core.CorrectionSet.from_string(data)</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>    </span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>pucorr <span class="op">=</span> evaluator[<span class="st">"Collisions16_UltraLegacy_goldenJSON"</span>]</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>mucorr <span class="op">=</span> evaluatorMU[<span class="st">"NUM_TightID_DEN_TrackerMuons"</span>]</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="store-data-for-histograms">Store data for histograms<a class="anchor" aria-label="anchor" href="#store-data-for-histograms"></a>
</h3>
<p>Now we will use the data we read from the .csv files to evaluate the
2 corrections and their uncertainties. We will slim down the number of
variables that we need to create our final Z’ mass histograms and put
everything in a final dictionary.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>histoData <span class="op">=</span> {}</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="cf">for</span> sample <span class="kw">in</span> datadict.keys():</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    histoData[sample] <span class="op">=</span> {</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>        <span class="st">"N_gen"</span>: N_gen[sample],</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>        <span class="st">"genWeight"</span>: datadict[sample][<span class="st">'weight'</span>]<span class="op">/</span>np.<span class="bu">abs</span>(datadict[sample][<span class="st">'weight'</span>]),</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>        <span class="st">"mtt"</span>: datadict[sample][<span class="st">'mtt'</span>],</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>        <span class="st">"pu_weight"</span>: [pucorr.evaluate(n,<span class="st">"nominal"</span>) <span class="cf">for</span> n <span class="kw">in</span> datadict[sample][<span class="st">'pileup'</span>]],</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>        <span class="st">"pu_weight_up"</span>: [pucorr.evaluate(n,<span class="st">"up"</span>) <span class="cf">for</span> n <span class="kw">in</span> datadict[sample][<span class="st">'pileup'</span>]],</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>        <span class="st">"pu_weight_dn"</span>: [pucorr.evaluate(n,<span class="st">"down"</span>) <span class="cf">for</span> n <span class="kw">in</span> datadict[sample][<span class="st">'pileup'</span>]],</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>        <span class="st">"muId_weight"</span>: [mucorr.evaluate(eta,pt,<span class="st">"nominal"</span>) <span class="cf">for</span> pt,eta <span class="kw">in</span> <span class="bu">zip</span>(datadict[sample][<span class="st">'mu_pt'</span>],datadict[sample][<span class="st">'mu_abseta'</span>])],</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>        <span class="st">"muId_weight_up"</span>: [mucorr.evaluate(eta,pt,<span class="st">"systup"</span>) <span class="cf">for</span> pt,eta <span class="kw">in</span> <span class="bu">zip</span>(datadict[sample][<span class="st">'mu_pt'</span>],datadict[sample][<span class="st">'mu_abseta'</span>])],</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>        <span class="st">"muId_weight_dn"</span>: [mucorr.evaluate(eta,pt,<span class="st">"systdown"</span>) <span class="cf">for</span> pt,eta <span class="kw">in</span> <span class="bu">zip</span>(datadict[sample][<span class="st">'mu_pt'</span>],datadict[sample][<span class="st">'mu_abseta'</span>])]</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>    } </span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="save-histogram-data">Save histogram data<a class="anchor" aria-label="anchor" href="#save-histogram-data"></a>
</h3>
<p>We need to open this histogram data in ROOT, so we will move over to
our other docker container. Let’s write <code>histoData</code> in a
pickle file that we can copy to our other folder. When you’re done with
this notebook, go back to the lesson page for the next script!</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'hists_for_ROOT.p'</span>,<span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>    pickle.dump(histoData,f)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Now we are ready to make our final histograms in ROOT. In your
terminal (but not inside either docker container), copy your pickle file
to the ROOT container’s shared folder, and then download the script that
will save a ROOT file:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">cp</span> hists_for_ROOT.p ../cms_open_data_root/  <span class="co">## Adjust if you have different paths</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="bu">cd</span> ../cms_open_data_root/</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">wget</span> https://raw.githubusercontent.com/cms-opendata-workshop/workshop2024-lesson-uncertainties/main/learners/saveTH1F.py</span></code></pre>
</div>
<p>Let’s investigate <code>saveTH1F.py</code>:</p>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  saveTH1F.py contents
  </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<p>First, two modules are imported from ROOT:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="im">from</span> ROOT <span class="im">import</span> TH1F, TFile</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="im">import</span> pickle</span></code></pre>
</div>
<p>Then we open the pickle file and extract the dictionary stored
inside:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>f <span class="op">=</span> <span class="bu">open</span>(<span class="st">'hists_for_ROOT.p'</span>, <span class="st">'rb'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>hists <span class="op">=</span> pickle.load(f)</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>f.close()</span></code></pre>
</div>
<p>To store histograms with the correct relative weights, we will need
their production cross sections, just as we saw in the plotting
example.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>xsec <span class="op">=</span> {<span class="st">'signal'</span>:<span class="fl">1.0</span>,</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>        <span class="st">'tt_semilep'</span>:<span class="fl">831.76</span><span class="op">*</span><span class="fl">0.438</span>,</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>        <span class="st">'tt_had'</span>:<span class="fl">831.76</span><span class="op">*</span><span class="fl">0.457</span>,</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>        <span class="st">'tt_lep'</span>:<span class="fl">831.76</span><span class="op">*</span><span class="fl">0.105</span>,</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>        <span class="st">'wjets'</span>:<span class="fl">61526.7</span>}</span></code></pre>
</div>
<p>Now we can make ROOT’s <code>TH1F</code> objects and fill them with
our data. The <code>TH1F</code> object is constructed with 5 inputs: an
object name, a string containing the axis labels, the number of bins,
the lowest bin edge, and the highest bin edge.</p>
<p>Note a few things:</p>
<ul>
<li>Collision data is treated differently from the other samples. The
histogram’s name includes <code>data_obs</code>.</li>
<li>Simulation is weighted by luminosity and cross section, but also by
the individual event’s positive or negative weight and the correction
factors that we extracted.</li>
<li>Variation histograms for two uncertainty sources are stored. In
these histograms one element of the event weight is adjusted.</li>
</ul>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>roothists <span class="op">=</span> {}</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="cf">for</span> sample <span class="kw">in</span> hists.keys():</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>    mtt <span class="op">=</span> hists[sample][<span class="st">'mtt'</span>]</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>    <span class="cf">if</span> sample <span class="op">==</span> <span class="st">"data"</span>:</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>        roothists[sample] <span class="op">=</span> TH1F(<span class="st">"mtt__data_obs"</span>,<span class="st">";m_{t#bar</span><span class="sc">{t}</span><span class="st">} (GeV);events"</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">3000</span>)</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>        roothists[sample].FillN(<span class="bu">len</span>(mtt), mtt, np.ones(<span class="bu">len</span>(mtt)))</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>        genweight <span class="op">=</span> hists[sample][<span class="st">'genWeight'</span>]</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>        Ngen <span class="op">=</span> hists[sample][<span class="st">'N_gen'</span>]</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>        lumiweight <span class="op">=</span> <span class="dv">16400</span><span class="op">*</span>xsec[sample]<span class="op">*</span>hists[sample][<span class="st">'genWeight'</span>]<span class="op">/</span>Ngen </span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>        weight <span class="op">=</span> lumiweight<span class="op">*</span>hists[sample][<span class="st">'pu_weight'</span>]<span class="op">*</span>hists[sample][<span class="st">'muId_weight'</span>]</span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>        pu_weight_up <span class="op">=</span> lumiweight<span class="op">*</span>hists[sample][<span class="st">'pu_weight_up'</span>]<span class="op">*</span>hists[sample][<span class="st">'muId_weight'</span>]</span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>        pu_weight_dn <span class="op">=</span> lumiweight<span class="op">*</span>hists[sample][<span class="st">'pu_weight_dn'</span>]<span class="op">*</span>hists[sample][<span class="st">'muId_weight'</span>]</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>        muId_weight_up <span class="op">=</span> lumiweight<span class="op">*</span>hists[sample][<span class="st">'pu_weight'</span>]<span class="op">*</span>hists[sample][<span class="st">'muId_weight_up'</span>]</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>        muId_weight_dn <span class="op">=</span> lumiweight<span class="op">*</span>hists[sample][<span class="st">'pu_weight'</span>]<span class="op">*</span>hists[sample][<span class="st">'muId_weight_dn'</span>]</span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_nominal'</span>] <span class="op">=</span> TH1F(<span class="st">"mtt__"</span><span class="op">+</span>sample,<span class="st">";m_{t#bar</span><span class="sc">{t}</span><span class="st">} (GeV);events"</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">3000</span>)</span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_nominal'</span>].FillN(<span class="bu">len</span>(mtt), mtt, weight)</span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_puUp'</span>] <span class="op">=</span> TH1F(<span class="st">"mtt__"</span><span class="op">+</span>sample<span class="op">+</span><span class="st">"__puUp"</span>,<span class="st">";m_{t#bar</span><span class="sc">{t}</span><span class="st">} (GeV);events"</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">3000</span>)</span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_puUp'</span>].FillN(<span class="bu">len</span>(mtt), mtt, pu_weight_up)</span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_puDn'</span>] <span class="op">=</span> TH1F(<span class="st">"mtt__"</span><span class="op">+</span>sample<span class="op">+</span><span class="st">"__puDown"</span>,<span class="st">";m_{t#bar</span><span class="sc">{t}</span><span class="st">} (GeV);events"</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">3000</span>)</span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_puDn'</span>].FillN(<span class="bu">len</span>(mtt), mtt, pu_weight_dn)</span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_muIdUp'</span>] <span class="op">=</span> TH1F(<span class="st">"mtt__"</span><span class="op">+</span>sample<span class="op">+</span><span class="st">"__muIdUp"</span>,<span class="st">";m_{t#bar</span><span class="sc">{t}</span><span class="st">} (GeV);events"</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">3000</span>)</span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_muIdUp'</span>].FillN(<span class="bu">len</span>(mtt), mtt, muId_weight_up)</span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_muIdDn'</span>] <span class="op">=</span> TH1F(<span class="st">"mtt__"</span><span class="op">+</span>sample<span class="op">+</span><span class="st">"__muIdDown"</span>,<span class="st">";m_{t#bar</span><span class="sc">{t}</span><span class="st">} (GeV);events"</span>,<span class="dv">50</span>,<span class="dv">0</span>,<span class="dv">3000</span>)</span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>        roothists[sample<span class="op">+</span><span class="st">'_muIdDn'</span>].FillN(<span class="bu">len</span>(mtt), mtt, muId_weight_dn)</span></code></pre>
</div>
<p>Finally, we will write all the <code>TH1F</code> objects in the
<code>roothists</code> dictionary to a ROOT file.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>output <span class="op">=</span> TFile.Open(<span class="st">"Zprime_hists_FULL.root"</span>,<span class="st">"recreate"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="cf">for</span> ihist <span class="kw">in</span> roothists:</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    roothists[ihist].Write()</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>output.Close()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Enter your ROOT docker container and run the script:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="ex">docker</span> start <span class="at">-i</span> my_root</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="ex">code/$</span> python <span class="at">-u</span> saveTH1F.py</span></code></pre>
</div>
<p>When the script completes, you should be able to open the file in
ROOT and list the contents:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">root</span> <span class="at">-l</span> Zprime_hists_FULL.root</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="ex">[1]</span> _file0-<span class="op">&gt;</span>ls<span class="er">(</span><span class="kw">)</span></span></code></pre>
</div>
<p>The list should show all the histograms, including uncertainty shift
histograms for simulation.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>TFile**         Zprime_hists_FULL.root
 TFile*         Zprime_hists_FULL.root
  KEY: TH1F     mtt__signal;1
  KEY: TH1F     mtt__signal__puUp;1
  KEY: TH1F     mtt__signal__puDown;1
  KEY: TH1F     mtt__signal__muIdUp;1
  KEY: TH1F     mtt__signal__muIdDown;1
  KEY: TH1F     mtt__tt_semilep;1
  KEY: TH1F     mtt__tt_semilep__puUp;1
  KEY: TH1F     mtt__tt_semilep__puDown;1
  KEY: TH1F     mtt__tt_semilep__muIdUp;1
  KEY: TH1F     mtt__tt_semilep__muIdDown;1
  KEY: TH1F     mtt__tt_had;1
  KEY: TH1F     mtt__tt_had__puUp;1
  KEY: TH1F     mtt__tt_had__puDown;1
  KEY: TH1F     mtt__tt_had__muIdUp;1
  KEY: TH1F     mtt__tt_had__muIdDown;1
  KEY: TH1F     mtt__tt_lep;1
  KEY: TH1F     mtt__tt_lep__puUp;1
  KEY: TH1F     mtt__tt_lep__puDown;1
  KEY: TH1F     mtt__tt_lep__muIdUp;1
  KEY: TH1F     mtt__tt_lep__muIdDown;1
  KEY: TH1F     mtt__wjets;1
  KEY: TH1F     mtt__wjets__puUp;1
  KEY: TH1F     mtt__wjets__puDown;1
  KEY: TH1F     mtt__wjets__muIdUp;1
  KEY: TH1F     mtt__wjets__muIdDown;1
  KEY: TH1F     mtt__data_obs;1</code></pre>
</div>
<p>Exit ROOT with <code>.q</code> and you can exit the ROOT container.
In the final workshop lesson we will see how to use this type of ROOT
file to set a limit on the production cross section for the <span class="math inline">\(Z`\)</span> boson.</p>
<div id="what-about-all-the-other-corrections-and-their-uncertainties" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="what-about-all-the-other-corrections-and-their-uncertainties" class="callout-inner">
<h3 class="callout-title">What about all the other corrections and their uncertainties?<a class="anchor" aria-label="anchor" href="#what-about-all-the-other-corrections-and-their-uncertainties"></a>
</h3>
<div class="callout-content">
<p>Examples of accessing and applying the other corrections found in the
other JSON files will be included in the CMS Open Data Guide. Our goal
is to complete this guide in 2024.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The correctionlib software provides a method to open and read
corrections in the common JSON format.</li>
<li>The <code>evaluate</code> method takes in a correction’s required
inputs and returns a correction value.</li>
<li>For event-weight corrections, save shifted event weight arrays to
create shifted histograms.</li>
<li>ROOT histograms can be created simply from arrays of data and
weights for statistical analysis.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/cms-opendata-workshop/workbench-template-md/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/cms-opendata-workshop/workbench-template-md/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/cms-opendata-workshop/workbench-template-md/" class="external-link">Source</a></p>
				<p><a href="https://github.com/cms-opendata-workshop/workbench-template-md/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:cms-dpoa-coordinator@cern.ch">Contact</a> | <a href="https://opendata.cern.ch/docs/about-cms" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/cms-opendata-workshop/varnish/tree/405b7a74ee1b2fc89c3e49e116ce96d4d65182b3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://cms-opendata-workshop.github.io/workbench-template-md/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, CMS",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://cms-opendata-workshop.github.io/workbench-template-md/aio.html",
  "identifier": "https://cms-opendata-workshop.github.io/workbench-template-md/aio.html",
  "dateCreated": "2024-07-29",
  "dateModified": "2024-07-31",
  "datePublished": "2024-07-31"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

